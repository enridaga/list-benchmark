prefix midi: <http://purl.org/midi-ld/midi#>
prefix midi-note: <http://purl.org/midi-ld/notes/>
prefix midi-prog: <http://purl.org/midi-ld/programs/>
prefix prov: <http://www.w3.org/ns/prov#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix xml: <http://www.w3.org/XML/1998/namespace>
prefix xsd: <http://www.w3.org/2001/XMLSchema#>
prefix sequence: <http://www.ontologydesignpatterns.org/cp/owl/sequence.owl#>

WITH <http://purl.org/midi-ld/piece/2eb43ce7edf27b505bcc0dfb6c283784>
DELETE
{
	<http://purl.org/midi-ld/piece/2473e18eec6cc55b82c5dddab3bea353/track00> midi:hasEvent ?event .
		?event sequence:precedes ?next .
		?next sequence:follows ?event .
		?prev sequence:precedes ?event .
		?event sequence:follows ?prev .
}
INSERT {
	<http://purl.org/midi-ld/piece/2473e18eec6cc55b82c5dddab3bea353/track00> midi:hasEvent <http://example.org/set-event-23789> .
		<http://example.org/set-event-23789> sequence:precedes ?next .
		?next sequence:follows <http://example.org/set-event-23789> .
		?prev sequence:precedes <http://example.org/set-event-23789> .
		<http://example.org/set-event-23789> sequence:follows ?prev .
}
WHERE {
	<http://purl.org/midi-ld/piece/2473e18eec6cc55b82c5dddab3bea353/track00> midi:hasEvent ?event 
	OPTIONAL { ?event sequence:precedes ?next } .
	OPTIONAL { ?event sequence:follows ?prev } .
	{{
		{{
		SELECT ?event (count(?prev) as ?i)
		WHERE {
			<http://purl.org/midi-ld/piece/2473e18eec6cc55b82c5dddab3bea353/track00> 
				midi:hasEvent ?event .
				?event sequence:follows* ?prev .
		} 
		GROUP BY ?event
		ORDER BY ?i
		LIMIT 1
		OFFSET 23789
		}}
	}}
}

# VERSION WITH FILTER(?i = 23789) AND NO ORDER BY SAME PERFORMANCE!